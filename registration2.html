<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registration Form</title>
    <link rel="stylesheet" href="styles_registration.css">
</head>

<body>
    <div class="registration-container">
        <form id="registerForm" enctype="multipart/form-data">
            <h2>Student Registration Form!</h2>

            <div class="grid">
                <div class="input-group">
                    <label for="firstName">First Name:</label>
                    <input type="text" id="firstName" name="firstName" required>
                </div>
                <div class="input-group">
                    <label for="middleName">Middle Name</label>
                    <input type="text" id="middleName" name="middleName">
                </div>
                <div class="input-group">
                    <label for="lastName">Last Name</label>
                    <input type="text" id="lastName" name="lastName" required>
                </div>
            </div>

            <div class="grid">
                <div class="input-group">
                    <label for="dob">Date of Birth</label>
                    <input type="date" id="dob" name="dob" required>
                </div>
                <div class="input-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" placeholder="Email address:" required>
                </div>
            </div>

            <div class="grid">
                <div class="input-group">
                    <label for="contact">Contact Number</label>
                    <input type="tel" id="contact" name="contact" pattern="^\d{10}$"
                        placeholder="Enter your contact number:" required>

                </div>
                <div class="input-group">
                    <label for="address">Address</label>
                    <input type="text" id="address" name="address" placeholder="Your current address:" required>
                </div>
            </div>

            <div class="input-group">
                <label for="faculty">Faculty</label>
                <select id="faculty" name="faculty" required>
                    <option value="">-- Select Faculty --</option>
                    <option value="BICTE">BICTE</option>
                    <option value="BEd.math">BEd.math</option>
                    <option value="BEd.science">BEd.science</option>
                    <option value="BEd.nepali">BEd.nepali</option>
                    <option value="BEd.political science">BEd.political science</option>
                </select>
            </div>
            <!-- <div class="display1"> -->
            <div id="academicFields">
                <div class="input-group" id="semesterGroup">
                    <label for="semester">Semester (1-8)</label>
                    <input type="number" id="semester" name="semester" min="1" max="8">
                </div>
                <div class="display1">
                    <div class="year-group">
                        <div class="input-group" id="startYearGroup">
                            <label for="startYear">Start Year</label>
                            <input type="number" id="startYear" name="startYear" min="2010">
                        </div>
                        <div class="input-group" id="endYearGroup">
                            <label for="endYear">End Year</label>
                            <input type="number" id="endYear" name="endYear" min="2010">
                        </div>
                        <div class="input-group" id="currentYearGroup">
                            <label for="currentYear">Current Year</label>
                            <input type="number" id="currentYear" name="currentYear" min="2010">
                        </div>
                    </div>
                </div>
            </div>
            <div class="display2">
                <div class="input-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" placeholder="Your username:" required>
                </div>

                <div class="input-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" placeholder="New password:" required>
                </div>

                <div class="input-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <input type="password" id="confirmPassword" placeholder="Confirm password:" required>
                </div>
            </div><br>
            <div class="input-group">
                <label for="photo">Passport Size Photo</label>
                <input type="file" id="photo" name="photo" accept="image/*" required />
            </div><br>

            <button type="submit">Register</button>
            <p id="message"></p>
            <a href="index.html">Back to login!</a>
        </form>
    </div>
    <script>
        const facultySelect = document.getElementById("faculty");
        const semesterGroup = document.getElementById("semesterGroup");
        const startYearGroup = document.getElementById("startYearGroup");
        const endYearGroup = document.getElementById("endYearGroup");
        const currentYearGroup = document.getElementById("currentYearGroup");

        facultySelect.addEventListener("change", () => {
            const isBICTE = facultySelect.value === "BICTE";

            semesterGroup.style.display = isBICTE ? "block" : "none";
            currentYearGroup.style.display = isBICTE ? "none" : "block";
            startYearGroup.style.display = "block";
            endYearGroup.style.display = "block";
        });

        facultySelect.dispatchEvent(new Event("change"));

        document.getElementById("registerForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const email = document.getElementById("email").value;
            const contact = document.getElementById("contact").value;
            const password = document.getElementById("password").value;
            const confirmPassword = document.getElementById("confirmPassword").value;
            const photo = document.getElementById("photo").files[0];

            const emailRegex = /^[^ ]+@[^ ]+\.[a-z]{2,3}$/;
            const contactRegex = /^[0-9]{10}$/;

            if (!emailRegex.test(email)) {
                alert("Invalid email format");
                return;
            }

            if (!contactRegex.test(contact)) {
                alert("Contact must be a 10-digit number");
                return;
            }

            if (password !== confirmPassword) {
                alert("Passwords do not match");
                return;
            }

            if (!photo) {
                alert("Please upload a passport size photo");
                return;
            }

            const formData = new FormData(document.getElementById("registerForm"));
            formData.append("photo", photo);

            const res = await fetch("http://localhost:3000/api/register", {
                method: "POST",
                body: formData
            });

            const result = await res.json();
            document.getElementById("message").textContent = result.message;
        });
    </script>
</body>

</html>